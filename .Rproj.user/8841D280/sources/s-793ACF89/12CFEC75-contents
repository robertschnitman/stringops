library(tidyverse)
library(stringops)

string_locate <- function(s, pattern, invert = FALSE, ...) {
  
  # type-check
  stopifnot(is.vector(s))
  
  # For invert matches
  num_char <- string_len(s)
  
  # Get locations
  locations <- gregexpr(pattern, s, ...)
  
  locations2 <- lapply(locations, function(x) x[seq_along(x)])
  
  # Output contingent on invert input.
  
  if (invert == FALSE) {
    
    output <- lapply(locations2, function(x) ifelse(x == -1, NA_character_, x))
    
  } else {
    
    positions <- sapply(num_char, function(x) 1:x)
    
    output <- Map(function(x, y) x[!x %in% y], positions, locations2)
    
  }
  
  output
  
}
